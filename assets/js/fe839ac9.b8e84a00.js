"use strict";(globalThis.webpackChunkzopp_docs=globalThis.webpackChunkzopp_docs||[]).push([[4741],{644(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"self-hosting/docker-compose","title":"Docker Compose","description":"Deploy zopp with Docker Compose for non-Kubernetes environments.","source":"@site/docs/self-hosting/docker-compose.md","sourceDirName":"self-hosting","slug":"/self-hosting/docker-compose","permalink":"/zopp/self-hosting/docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/faiscadev/zopp/tree/main/docs/docs/self-hosting/docker-compose.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Docker Compose","description":"Deploy zopp with Docker Compose for non-Kubernetes environments."},"sidebar":"docs","previous":{"title":"Server Deployment","permalink":"/zopp/self-hosting/server"},"next":{"title":"Database Setup","permalink":"/zopp/self-hosting/database"}}');var r=n(4848),t=n(8453);const i={sidebar_position:4,title:"Docker Compose",description:"Deploy zopp with Docker Compose for non-Kubernetes environments."},c="Docker Compose Deployment",a={},l=[{value:"Quick Start",id:"quick-start",level:2},{value:"Development Setup",id:"development-setup",level:2},{value:"Production Setup",id:"production-setup",level:2},{value:"1. Generate TLS Certificates",id:"1-generate-tls-certificates",level:3},{value:"2. Set a Secure Password",id:"2-set-a-secure-password",level:3},{value:"3. Start the Stack",id:"3-start-the-stack",level:3},{value:"4. Create First User",id:"4-create-first-user",level:3},{value:"Connecting Clients",id:"connecting-clients",level:2},{value:"Operations",id:"operations",level:2},{value:"View Logs",id:"view-logs",level:3},{value:"Backup Database",id:"backup-database",level:3},{value:"Restore Database",id:"restore-database",level:3},{value:"Update zopp",id:"update-zopp",level:3},{value:"Create Additional Invites",id:"create-additional-invites",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Refused",id:"connection-refused",level:3},{value:"Database Connection Errors",id:"database-connection-errors",level:3},{value:"TLS Certificate Errors",id:"tls-certificate-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function p(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"docker-compose-deployment",children:"Docker Compose Deployment"})}),"\n",(0,r.jsx)(s.p,{children:"This guide shows how to deploy zopp with Docker Compose\u2014ideal for teams not using Kubernetes."}),"\n",(0,r.jsx)(s.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Clone and start\ngit clone https://github.com/faiscadev/zopp.git\ncd zopp/examples/docker-compose\ndocker compose up -d\n\n# Create first user invite\ndocker compose exec zopp-server zopp-server invite create --expires-hours 48\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Your zopp server is now running at ",(0,r.jsx)(s.code,{children:"localhost:50051"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"development-setup",children:"Development Setup"}),"\n",(0,r.jsxs)(s.p,{children:["The basic ",(0,r.jsx)(s.code,{children:"docker-compose.yml"})," includes:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"zopp server on port 50051"}),"\n",(0,r.jsx)(s.li,{children:"PostgreSQL 16 with persistent storage"}),"\n",(0,r.jsx)(s.li,{children:"Health checks for both services"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'services:\n  zopp-server:\n    image: ghcr.io/faiscadev/zopp-server:latest\n    ports:\n      - "50051:50051"\n      - "8080:8080"\n    environment:\n      DATABASE_URL: postgres://zopp:zopp@postgres:5432/zopp\n    depends_on:\n      postgres:\n        condition: service_healthy\n\n  postgres:\n    image: postgres:16-alpine\n    environment:\n      POSTGRES_USER: zopp\n      POSTGRES_PASSWORD: zopp\n      POSTGRES_DB: zopp\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U zopp -d zopp"]\n      interval: 5s\n      timeout: 5s\n      retries: 5\n\nvolumes:\n  postgres-data:\n'})}),"\n",(0,r.jsx)(s.h2,{id:"production-setup",children:"Production Setup"}),"\n",(0,r.jsxs)(s.p,{children:["For production, use ",(0,r.jsx)(s.code,{children:"docker-compose.production.yml"})," which adds:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"TLS encryption"}),"\n",(0,r.jsx)(s.li,{children:"Resource limits"}),"\n",(0,r.jsx)(s.li,{children:"Environment-based password configuration"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"1-generate-tls-certificates",children:"1. Generate TLS Certificates"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'mkdir -p certs\n\n# Option A: Self-signed (testing only)\nopenssl req -x509 -newkey rsa:4096 \\\n  -keyout certs/server.key -out certs/server.crt \\\n  -days 365 -nodes -subj "/CN=zopp.example.com"\n\n# Option B: Let\'s Encrypt (production)\n# Use certbot or your preferred ACME client\n'})}),"\n",(0,r.jsx)(s.h3,{id:"2-set-a-secure-password",children:"2. Set a Secure Password"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'export POSTGRES_PASSWORD=$(openssl rand -base64 32)\necho "Save this password: $POSTGRES_PASSWORD"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"3-start-the-stack",children:"3. Start the Stack"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose -f docker-compose.production.yml up -d\n"})}),"\n",(0,r.jsx)(s.h3,{id:"4-create-first-user",children:"4. Create First User"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose -f docker-compose.production.yml exec zopp-server \\\n  zopp-server invite create --expires-hours 48\n"})}),"\n",(0,r.jsx)(s.h2,{id:"connecting-clients",children:"Connecting Clients"}),"\n",(0,r.jsx)(s.p,{children:"Configure the CLI to connect to your server:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Development (no TLS)\nzopp --server http://localhost:50051 join <token> you@example.com\n\n# Production (TLS)\nzopp --server https://zopp.example.com:50051 join <token> you@example.com\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Or set defaults in ",(0,r.jsx)(s.code,{children:"~/.zopp/config.json"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "server_url": "https://zopp.example.com:50051"\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"operations",children:"Operations"}),"\n",(0,r.jsx)(s.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose logs -f zopp-server\n"})}),"\n",(0,r.jsx)(s.h3,{id:"backup-database",children:"Backup Database"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose exec postgres pg_dump -U zopp zopp > backup-$(date +%Y%m%d).sql\n"})}),"\n",(0,r.jsx)(s.h3,{id:"restore-database",children:"Restore Database"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cat backup.sql | docker compose exec -T postgres psql -U zopp zopp\n"})}),"\n",(0,r.jsx)(s.h3,{id:"update-zopp",children:"Update zopp"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose pull\ndocker compose up -d\n"})}),"\n",(0,r.jsx)(s.h3,{id:"create-additional-invites",children:"Create Additional Invites"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose exec zopp-server zopp-server invite create --expires-hours 48\n"})}),"\n",(0,r.jsx)(s.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsx)(s.p,{children:"The server exposes health endpoints on port 8080:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Liveness (server is running)\ncurl http://localhost:8080/healthz\n\n# Readiness (server can handle requests)\ncurl http://localhost:8080/readyz\n"})}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(s.h3,{id:"connection-refused",children:"Connection Refused"}),"\n",(0,r.jsx)(s.p,{children:"Check that both services are running:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose ps\ndocker compose logs zopp-server\n"})}),"\n",(0,r.jsx)(s.h3,{id:"database-connection-errors",children:"Database Connection Errors"}),"\n",(0,r.jsx)(s.p,{children:"Wait for PostgreSQL to be ready:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker compose logs postgres\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The zopp server waits for the ",(0,r.jsx)(s.code,{children:"postgres"})," health check before starting."]}),"\n",(0,r.jsx)(s.h3,{id:"tls-certificate-errors",children:"TLS Certificate Errors"}),"\n",(0,r.jsx)(s.p,{children:"Verify certificate paths and permissions:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"ls -la certs/\ndocker compose exec zopp-server ls -la /certs/\n"})}),"\n",(0,r.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/self-hosting/server",children:"Server Deployment"})," - Other deployment options"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/self-hosting/tls",children:"TLS Configuration"})," - Advanced TLS setup"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"/guides/team-collaboration",children:"Team Collaboration"})," - Invite your team"]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8453(e,s,n){n.d(s,{R:()=>i,x:()=>c});var o=n(6540);const r={},t=o.createContext(r);function i(e){const s=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(t.Provider,{value:s},e.children)}}}]);
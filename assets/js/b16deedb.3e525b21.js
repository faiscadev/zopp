"use strict";(globalThis.webpackChunkzopp_docs=globalThis.webpackChunkzopp_docs||[]).push([[6778],{8453(e,s,n){n.d(s,{R:()=>r,x:()=>l});var t=n(6540);const o={},i=t.createContext(o);function r(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:s},e.children)}},9500(e,s,n){n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"self-hosting/database","title":"Database Setup","description":"Configure SQLite or PostgreSQL for zopp.","source":"@site/docs/self-hosting/database.md","sourceDirName":"self-hosting","slug":"/self-hosting/database","permalink":"/zopp/self-hosting/database","draft":false,"unlisted":false,"editUrl":"https://github.com/faiscadev/zopp/tree/main/docs/docs/self-hosting/database.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Database Setup","description":"Configure SQLite or PostgreSQL for zopp."},"sidebar":"docs","previous":{"title":"Docker Compose","permalink":"/zopp/self-hosting/docker-compose"},"next":{"title":"TLS Configuration","permalink":"/zopp/self-hosting/tls"}}');var o=n(4848),i=n(8453);const r={sidebar_position:3,title:"Database Setup",description:"Configure SQLite or PostgreSQL for zopp."},l="Database Setup",d={},a=[{value:"SQLite (Default)",id:"sqlite-default",level:2},{value:"When to Use SQLite",id:"when-to-use-sqlite",level:3},{value:"SQLite Best Practices",id:"sqlite-best-practices",level:3},{value:"PostgreSQL (Production)",id:"postgresql-production",level:2},{value:"When to Use PostgreSQL",id:"when-to-use-postgresql",level:3},{value:"PostgreSQL Setup",id:"postgresql-setup",level:3},{value:"Connection Pool",id:"connection-pool",level:3},{value:"Backups",id:"backups",level:2},{value:"SQLite",id:"sqlite",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"database-setup",children:"Database Setup"})}),"\n",(0,o.jsx)(s.p,{children:"zopp supports two database backends: SQLite for simple deployments and PostgreSQL for production."}),"\n",(0,o.jsx)(s.h2,{id:"sqlite-default",children:"SQLite (Default)"}),"\n",(0,o.jsx)(s.p,{children:"SQLite is the default and requires no configuration:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Uses default path: ./zopp.db\n./zopp-server serve\n\n# Custom path\n./zopp-server serve --db /var/lib/zopp/zopp.db\n"})}),"\n",(0,o.jsx)(s.h3,{id:"when-to-use-sqlite",children:"When to Use SQLite"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Development environments"}),"\n",(0,o.jsx)(s.li,{children:"Small teams (< 10 users)"}),"\n",(0,o.jsx)(s.li,{children:"Single-server deployments"}),"\n",(0,o.jsx)(s.li,{children:"Low request volume"}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"sqlite-best-practices",children:"SQLite Best Practices"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Use a dedicated directory"}),": ",(0,o.jsx)(s.code,{children:"/var/lib/zopp/"})]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Regular backups"}),": ",(0,o.jsx)(s.code,{children:'sqlite3 zopp.db ".backup backup.db"'})]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"SSD storage"}),": SQLite benefits from fast disk I/O"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"postgresql-production",children:"PostgreSQL (Production)"}),"\n",(0,o.jsx)(s.p,{children:"PostgreSQL is recommended for production:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Environment variable\nexport DATABASE_URL=postgres://user:password@localhost:5432/zopp\n./zopp-server serve\n\n# Or as a flag\n./zopp-server serve --database-url postgres://user:password@localhost:5432/zopp\n"})}),"\n",(0,o.jsx)(s.h3,{id:"when-to-use-postgresql",children:"When to Use PostgreSQL"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Production environments"}),"\n",(0,o.jsx)(s.li,{children:"Large teams"}),"\n",(0,o.jsx)(s.li,{children:"High availability requirements"}),"\n",(0,o.jsx)(s.li,{children:"Multiple server instances"}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"postgresql-setup",children:"PostgreSQL Setup"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Create the database"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-sql",children:"CREATE DATABASE zopp;\nCREATE USER zopp WITH PASSWORD 'your-password';\nGRANT ALL PRIVILEGES ON DATABASE zopp TO zopp;\n-- Required for PostgreSQL 15+ (public schema permissions changed)\n\\c zopp\nGRANT ALL ON SCHEMA public TO zopp;\n"})}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Run the server"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"DATABASE_URL=postgres://zopp:your-password@localhost/zopp ./zopp-server serve\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Migrations run automatically on startup."}),"\n",(0,o.jsx)(s.h3,{id:"connection-pool",children:"Connection Pool"}),"\n",(0,o.jsx)(s.p,{children:"zopp uses a connection pool with sensible defaults:"}),"\n",(0,o.jsxs)(s.table,{children:[(0,o.jsx)(s.thead,{children:(0,o.jsxs)(s.tr,{children:[(0,o.jsx)(s.th,{children:"Setting"}),(0,o.jsx)(s.th,{children:"Default"}),(0,o.jsx)(s.th,{children:"Description"})]})}),(0,o.jsxs)(s.tbody,{children:[(0,o.jsxs)(s.tr,{children:[(0,o.jsx)(s.td,{children:"Max connections"}),(0,o.jsx)(s.td,{children:"10"}),(0,o.jsx)(s.td,{children:"Maximum pool size"})]}),(0,o.jsxs)(s.tr,{children:[(0,o.jsx)(s.td,{children:"Min connections"}),(0,o.jsx)(s.td,{children:"1"}),(0,o.jsx)(s.td,{children:"Minimum idle connections"})]}),(0,o.jsxs)(s.tr,{children:[(0,o.jsx)(s.td,{children:"Connect timeout"}),(0,o.jsx)(s.td,{children:"30s"}),(0,o.jsx)(s.td,{children:"Connection timeout"})]})]})]}),"\n",(0,o.jsx)(s.h2,{id:"backups",children:"Backups"}),"\n",(0,o.jsx)(s.h3,{id:"sqlite",children:"SQLite"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'# Simple backup\nsqlite3 /var/lib/zopp/zopp.db ".backup /backup/zopp-$(date +%Y%m%d).db"\n\n# Scheduled (cron)\n0 2 * * * sqlite3 /var/lib/zopp/zopp.db ".backup /backup/zopp-$(date +\\%Y\\%m\\%d).db"\n'})}),"\n",(0,o.jsx)(s.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Full backup\npg_dump -h localhost -U zopp zopp > /backup/zopp-$(date +%Y%m%d).sql\n\n# Compressed\npg_dump -h localhost -U zopp zopp | gzip > /backup/zopp-$(date +%Y%m%d).sql.gz\n"})}),"\n",(0,o.jsx)(s.admonition,{type:"caution",children:(0,o.jsx)(s.p,{children:"Never lose your database! While secrets are encrypted, the wrapped keys that allow decryption are stored there. Without the database, users cannot decrypt their secrets."})}),"\n",(0,o.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.a,{href:"/self-hosting/tls",children:"TLS Configuration"})," - Secure your deployment"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.a,{href:"/self-hosting/server",children:"Server Deployment"})," - Deployment options"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);
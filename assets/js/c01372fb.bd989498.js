"use strict";(globalThis.webpackChunkzopp_docs=globalThis.webpackChunkzopp_docs||[]).push([[361],{4681(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"installation/kubernetes","title":"Kubernetes Installation","description":"Deploy zopp to Kubernetes using Helm.","source":"@site/docs/installation/kubernetes.md","sourceDirName":"installation","slug":"/installation/kubernetes","permalink":"/zopp/installation/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/faiscadev/zopp/tree/main/docs/docs/installation/kubernetes.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Kubernetes Installation","description":"Deploy zopp to Kubernetes using Helm."},"sidebar":"docs","previous":{"title":"Docker Installation","permalink":"/zopp/installation/docker"},"next":{"title":"Guides","permalink":"/zopp/guides/"}}');var t=r(4848),l=r(8453);const i={sidebar_position:4,title:"Kubernetes Installation",description:"Deploy zopp to Kubernetes using Helm."},a="Kubernetes Installation",c={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Install",id:"quick-install",level:2},{value:"1. Install the Helm chart",id:"1-install-the-helm-chart",level:3},{value:"2. Create a server invite",id:"2-create-a-server-invite",level:3},{value:"3. Join the server",id:"3-join-the-server",level:3},{value:"Components",id:"components",level:2},{value:"Server",id:"server",level:3},{value:"Operator",id:"operator",level:3},{value:"Common Configurations",id:"common-configurations",level:2},{value:"PostgreSQL Backend",id:"postgresql-backend",level:3},{value:"TLS Encryption",id:"tls-encryption",level:3},{value:"Operator-Only Mode",id:"operator-only-mode",level:3},{value:"Operator Credentials",id:"operator-credentials",level:2},{value:"1. Create operator credentials locally",id:"1-create-operator-credentials-locally",level:3},{value:"2. Create the Kubernetes secret",id:"2-create-the-kubernetes-secret",level:3},{value:"3. Reference in Helm values",id:"3-reference-in-helm-values",level:3},{value:"Using ZoppSecret Resources",id:"using-zoppsecret-resources",level:2},{value:"Values Reference",id:"values-reference",level:2},{value:"Key Values",id:"key-values",level:3},{value:"Upgrading",id:"upgrading",level:2},{value:"Uninstalling",id:"uninstalling",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-installation",children:"Kubernetes Installation"})}),"\n",(0,t.jsx)(n.p,{children:"The zopp Helm chart deploys both the server and the Kubernetes operator, which automatically syncs zopp secrets to Kubernetes Secrets."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Kubernetes 1.24+"}),"\n",(0,t.jsx)(n.li,{children:"Helm 3.8+"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"kubectl"})," configured for your cluster"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"quick-install",children:"Quick Install"}),"\n",(0,t.jsx)(n.h3,{id:"1-install-the-helm-chart",children:"1. Install the Helm chart"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install zopp oci://ghcr.io/faiscadev/charts/zopp --version 0.1.0\n"})}),"\n",(0,t.jsx)(n.p,{children:"This deploys:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"zopp server with SQLite storage"}),"\n",(0,t.jsx)(n.li,{children:"zopp operator watching all namespaces"}),"\n",(0,t.jsx)(n.li,{children:"Required RBAC resources"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-create-a-server-invite",children:"2. Create a server invite"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it deploy/zopp-server -- zopp-server invite create --expires-hours 48\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-join-the-server",children:"3. Join the server"}),"\n",(0,t.jsx)(n.p,{children:"On your local machine with the CLI installed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"zopp --server http://localhost:50051 join <token> your@email.com\n"})}),"\n",(0,t.jsx)(n.p,{children:"Port-forward if needed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward svc/zopp-server 50051:50051\n"})}),"\n",(0,t.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,t.jsx)(n.h3,{id:"server",children:"Server"}),"\n",(0,t.jsx)(n.p,{children:"The zopp gRPC server stores encrypted secrets and handles authentication."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"server:\n  enabled: true\n  replicaCount: 1\n\n  database:\n    type: sqlite  # or postgres\n    sqlite:\n      path: /data/zopp.db\n      persistence:\n        enabled: true\n        size: 1Gi\n"})}),"\n",(0,t.jsx)(n.h3,{id:"operator",children:"Operator"}),"\n",(0,t.jsxs)(n.p,{children:["The operator watches for ",(0,t.jsx)(n.code,{children:"ZoppSecret"})," custom resources and syncs them to Kubernetes Secrets."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'operator:\n  enabled: true\n  watchNamespace: ""  # Empty = watch all namespaces\n\n  credentials:\n    existingSecret: zopp-operator-credentials\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The operator requires credentials to authenticate with the zopp server. See ",(0,t.jsx)(n.a,{href:"#operator-credentials",children:"setting up operator credentials"})," below."]})}),"\n",(0,t.jsx)(n.h2,{id:"common-configurations",children:"Common Configurations"}),"\n",(0,t.jsx)(n.h3,{id:"postgresql-backend",children:"PostgreSQL Backend"}),"\n",(0,t.jsx)(n.p,{children:"For production, use PostgreSQL instead of SQLite:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# values-postgres.yaml\nserver:\n  database:\n    type: postgres\n    postgres:\n      existingSecret: zopp-db-credentials\n      existingSecretKey: DATABASE_URL\n"})}),"\n",(0,t.jsx)(n.p,{children:"Create the secret:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'kubectl create secret generic zopp-db-credentials \\\n  --from-literal=DATABASE_URL="postgres://user:pass@postgres.example.com/zopp"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Install:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install zopp oci://ghcr.io/faiscadev/charts/zopp \\\n  --version 0.1.0 \\\n  -f values-postgres.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tls-encryption",children:"TLS Encryption"}),"\n",(0,t.jsx)(n.p,{children:"Enable TLS for the server:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# values-tls.yaml\nserver:\n  tls:\n    enabled: true\n    existingSecret: zopp-server-tls  # Contains tls.crt and tls.key\n"})}),"\n",(0,t.jsx)(n.p,{children:"Create the TLS secret:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create secret tls zopp-server-tls \\\n  --cert=server.crt \\\n  --key=server.key\n"})}),"\n",(0,t.jsx)(n.h3,{id:"operator-only-mode",children:"Operator-Only Mode"}),"\n",(0,t.jsx)(n.p,{children:"If you have a central zopp server and just need the operator:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# values-operator-only.yaml\nserver:\n  enabled: false\n\noperator:\n  enabled: true\n  server:\n    address: "zopp.example.com:50051"\n    tls:\n      enabled: true\n      existingSecret: zopp-server-ca  # Contains ca.crt\n\n  credentials:\n    existingSecret: zopp-operator-credentials\n'})}),"\n",(0,t.jsx)(n.h2,{id:"operator-credentials",children:"Operator Credentials"}),"\n",(0,t.jsx)(n.p,{children:"The operator needs credentials to authenticate with the zopp server:"}),"\n",(0,t.jsx)(n.h3,{id:"1-create-operator-credentials-locally",children:"1. Create operator credentials locally"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Join the server as a service principal\nzopp join <invite-token> operator@yourcluster\n\n# Or create a dedicated service principal\nzopp principal create k8s-operator --service -w myworkspace\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-create-the-kubernetes-secret",children:"2. Create the Kubernetes secret"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic zopp-operator-credentials \\\n  --from-file=config.json=$HOME/.zopp/config.json\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-reference-in-helm-values",children:"3. Reference in Helm values"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"operator:\n  credentials:\n    existingSecret: zopp-operator-credentials\n"})}),"\n",(0,t.jsx)(n.h2,{id:"using-zoppsecret-resources",children:"Using ZoppSecret Resources"}),"\n",(0,t.jsxs)(n.p,{children:["Once the operator is running, create ",(0,t.jsx)(n.code,{children:"ZoppSecret"})," resources to sync secrets:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: zopp.dev/v1alpha1\nkind: ZoppSecret\nmetadata:\n  name: my-app-secrets\n  namespace: default\nspec:\n  workspace: mycompany\n  project: backend\n  environment: production\n  secretName: my-app-env  # Name of the K8s Secret to create\n"})}),"\n",(0,t.jsx)(n.p,{children:"The operator will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Fetch secrets from zopp"}),"\n",(0,t.jsx)(n.li,{children:"Create/update the Kubernetes Secret"}),"\n",(0,t.jsx)(n.li,{children:"Keep it in sync with zopp"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"values-reference",children:"Values Reference"}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"https://github.com/faiscadev/zopp/tree/main/charts/zopp",children:"Helm Chart README"})," for a complete list of configuration options."]}),"\n",(0,t.jsx)(n.h3,{id:"key-values",children:"Key Values"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"server.enabled"})}),(0,t.jsx)(n.td,{children:"Deploy the server"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"server.database.type"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"sqlite"})," or ",(0,t.jsx)(n.code,{children:"postgres"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sqlite"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"server.tls.enabled"})}),(0,t.jsx)(n.td,{children:"Enable TLS"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"false"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"operator.enabled"})}),(0,t.jsx)(n.td,{children:"Deploy the operator"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"operator.watchNamespace"})}),(0,t.jsx)(n.td,{children:"Namespace to watch"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:'""'})," (all)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"rbac.clusterWide"})}),(0,t.jsx)(n.td,{children:"Use ClusterRole"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"upgrading",children:"Upgrading"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgrade zopp oci://ghcr.io/faiscadev/charts/zopp --version 0.1.1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"uninstalling",children:"Uninstalling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm uninstall zopp\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)(n.p,{children:"PersistentVolumeClaims are not deleted automatically. Remove manually if needed:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl delete pvc -l app.kubernetes.io/instance=zopp\n"})})]}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/guides/kubernetes-operator",children:"Kubernetes Operator Guide"})," - Detailed operator usage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/self-hosting",children:"Self-Hosting Guide"})," - Production deployment considerations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/self-hosting/tls",children:"TLS Configuration"})," - Secure your deployment"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var s=r(6540);const t={},l=s.createContext(t);function i(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);
---
title: Server Deployment
description: Deploy the zopp server.
---

import { Tabs, TabItem, Steps, Aside } from '@astrojs/starlight/components';

This guide covers deploying the zopp server as a standalone service.

## Installation

<Tabs>
  <TabItem label="Binary">
    Download the pre-built binary:

    ```bash
    # Linux (x86_64)
    curl -fsSL https://github.com/faiscadev/zopp/releases/latest/download/zopp-server-linux-x86_64 -o zopp-server

    # Linux (ARM64)
    curl -fsSL https://github.com/faiscadev/zopp/releases/latest/download/zopp-server-linux-arm64 -o zopp-server

    # macOS (Intel)
    curl -fsSL https://github.com/faiscadev/zopp/releases/latest/download/zopp-server-darwin-x86_64 -o zopp-server

    # macOS (Apple Silicon)
    curl -fsSL https://github.com/faiscadev/zopp/releases/latest/download/zopp-server-darwin-arm64 -o zopp-server

    chmod +x zopp-server
    sudo mv zopp-server /usr/local/bin/
    ```
  </TabItem>
  <TabItem label="Docker">
    Pull the official image:

    ```bash
    docker pull ghcr.io/faiscadev/zopp-server:latest
    ```
  </TabItem>
  <TabItem label="Build from Source">
    Build from source:

    ```bash
    git clone https://github.com/faiscadev/zopp.git
    cd zopp
    cargo build --release --package zopp-server
    sudo cp target/release/zopp-server /usr/local/bin/
    ```
  </TabItem>
</Tabs>

## Basic Usage

### Start the Server

```bash
# SQLite (default)
zopp-server serve

# With explicit database path
zopp-server serve --db /var/lib/zopp/zopp.db

# PostgreSQL
DATABASE_URL=postgres://user:pass@localhost/zopp zopp-server serve

# With TLS
zopp-server serve --tls-cert /etc/zopp/server.crt --tls-key /etc/zopp/server.key
```

### Create User Invites

```bash
# Create an invite for the first user
zopp-server invite create --expires-hours 48 --db /var/lib/zopp/zopp.db
```

## Command Reference

### zopp-server serve

Start the gRPC server.

| Option | Environment Variable | Default | Description |
|--------|---------------------|---------|-------------|
| `--db <PATH>` | | `~/.zopp/zopp.db` | SQLite database path |
| `--port <PORT>` | | `50051` | gRPC port |
| `--health-port <PORT>` | | `8080` | Health check HTTP port |
| `--tls-cert <PATH>` | `ZOPP_TLS_CERT` | | TLS certificate path |
| `--tls-key <PATH>` | `ZOPP_TLS_KEY` | | TLS private key path |
| `--tls-client-ca <PATH>` | `ZOPP_TLS_CLIENT_CA` | | Client CA for mTLS |

PostgreSQL is used when `DATABASE_URL` environment variable is set.

### zopp-server invite create

Create a server invite for new users.

| Option | Description |
|--------|-------------|
| `--expires-hours <N>` | Hours until expiration (default: 48) |
| `--db <PATH>` | SQLite database path (for SQLite backend) |

## Systemd Service

Create a systemd service for automatic startup:

```ini
# /etc/systemd/system/zopp-server.service
[Unit]
Description=zopp Secrets Manager Server
After=network.target

[Service]
Type=simple
User=zopp
Group=zopp
ExecStart=/usr/local/bin/zopp-server serve --db /var/lib/zopp/zopp.db
Restart=always
RestartSec=5

# Security hardening
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/zopp

[Install]
WantedBy=multi-user.target
```

<Steps>

1. Create the zopp user and directories:
   ```bash
   sudo useradd -r -s /bin/false zopp
   sudo mkdir -p /var/lib/zopp
   sudo chown zopp:zopp /var/lib/zopp
   ```

2. Install the service:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable zopp-server
   sudo systemctl start zopp-server
   ```

3. Check status:
   ```bash
   sudo systemctl status zopp-server
   ```

</Steps>

## Docker Deployment

### Docker Run

```bash
docker run -d \
  --name zopp-server \
  -p 50051:50051 \
  -p 8080:8080 \
  -v zopp-data:/data \
  ghcr.io/faiscadev/zopp-server:latest
```

### Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  zopp-server:
    image: ghcr.io/faiscadev/zopp-server:latest
    ports:
      - "50051:50051"
      - "8080:8080"
    volumes:
      - zopp-data:/data
    restart: unless-stopped

volumes:
  zopp-data:
```

### With PostgreSQL

```yaml
# docker-compose.yml
version: '3.8'

services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: zopp
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: zopp
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U zopp"]
      interval: 5s
      timeout: 5s
      retries: 5

  zopp-server:
    image: ghcr.io/faiscadev/zopp-server:latest
    ports:
      - "50051:50051"
      - "8080:8080"
    environment:
      DATABASE_URL: postgres://zopp:${POSTGRES_PASSWORD}@postgres:5432/zopp
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

volumes:
  postgres-data:
```

## Configuration

### Network Binding

By default, the server binds to `0.0.0.0:50051`. For security, you may want to bind to a specific interface:

```bash
# Bind to localhost only (use with reverse proxy)
zopp-server serve --bind 127.0.0.1:50051
```

### Behind a Reverse Proxy

If running behind nginx or similar:

```nginx
# /etc/nginx/conf.d/zopp.conf
upstream zopp_grpc {
    server 127.0.0.1:50051;
}

server {
    listen 443 ssl http2;
    server_name zopp.example.com;

    ssl_certificate /etc/letsencrypt/live/zopp.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/zopp.example.com/privkey.pem;

    location / {
        grpc_pass grpc://zopp_grpc;
    }
}
```

<Aside type="note">
  gRPC requires HTTP/2. Ensure your reverse proxy supports HTTP/2 to gRPC backends.
</Aside>

## Logging

The server logs to stdout by default. Configure log level with `RUST_LOG`:

```bash
# Error only
RUST_LOG=error zopp-server serve

# Debug (verbose)
RUST_LOG=debug zopp-server serve

# Specific component
RUST_LOG=zopp_server=debug,zopp_storage=info zopp-server serve
```

## Next Steps

- [Database Setup](/zopp/self-hosting/database/) - Configure PostgreSQL for production
- [TLS Configuration](/zopp/self-hosting/tls/) - Secure with TLS/mTLS
- [Kubernetes Installation](/zopp/installation/kubernetes/) - Deploy to K8s

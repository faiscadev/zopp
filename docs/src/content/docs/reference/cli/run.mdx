---
title: run
description: Execute commands with secrets injected as environment variables.
---

The `run` command executes a command with all secrets from an environment injected as environment variables.

## Usage

```bash
zopp run [-w <WORKSPACE>] [-p <PROJECT>] [-e <ENVIRONMENT>] -- <COMMAND> [ARGS...]
```

## Options

| Option | Description |
|--------|-------------|
| `-w, --workspace <NAME>` | Workspace name (optional if in `zopp.toml`) |
| `-p, --project <NAME>` | Project name (optional if in `zopp.toml`) |
| `-e, --environment <NAME>` | Environment name (optional if in `zopp.toml`) |

## Arguments

| Argument | Description |
|----------|-------------|
| `--` | Separator between zopp options and the command |
| `COMMAND` | Command to run |
| `ARGS...` | Arguments to pass to the command |

## Examples

### Basic usage

```bash
zopp run -- npm start
```

### Verify secrets are available

```bash
zopp run -- printenv DATABASE_URL
# postgresql://user:pass@localhost/db

zopp run -- env | grep API
# API_KEY=sk_live_abc123
```

### Override environment

```bash
# Use production secrets
zopp run -e production -- ./deploy.sh
```

### Pass arguments to command

```bash
zopp run -- python manage.py migrate --noinput
```

### Complex commands

```bash
zopp run -- bash -c "echo \$DATABASE_URL | grep postgres"
```

---

## How It Works

1. Fetches all secrets from the specified environment
2. Decrypts each secret client-side
3. Sets each secret as an environment variable
4. Spawns the specified command with the enriched environment
5. Returns the command's exit code

```
┌──────────────────────────────────────────────────────────┐
│                     zopp run                             │
│                                                          │
│  1. Fetch encrypted secrets from server                  │
│  2. Decrypt with your keys (client-side)                 │
│  3. Set as environment variables                         │
│  4. Execute: npm start                                   │
│                                                          │
│  ┌────────────────────────────────────────────────────┐  │
│  │ Child Process                                      │  │
│  │                                                    │  │
│  │ DATABASE_URL=postgresql://...                      │  │
│  │ API_KEY=sk_live_...                                │  │
│  │ REDIS_URL=redis://...                              │  │
│  │                                                    │  │
│  │ > npm start                                        │  │
│  └────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────┘
```

---

## With zopp.toml

Configure defaults to simplify commands:

```toml
# zopp.toml
[defaults]
workspace = "mycompany"
project = "api-backend"
environment = "development"
```

```bash
# Uses development environment
zopp run -- npm start

# Override for production
zopp run -e production -- npm start
```

---

## Common Use Cases

### Local development

```bash
# Start development server with secrets
zopp run -- npm run dev

# Run database migrations
zopp run -- npx prisma migrate dev
```

### Testing

```bash
# Run tests with test environment secrets
zopp run -e testing -- npm test
```

### One-off scripts

```bash
# Run a script that needs database access
zopp run -- python scripts/backfill.py

# Check a specific secret value
zopp run -- printenv STRIPE_SECRET_KEY
```

### Docker

```bash
# Build with secrets (careful: don't leak into image!)
zopp run -- docker build --build-arg API_KEY=$API_KEY .

# Run container with secrets
zopp run -- docker run -e DATABASE_URL myapp
```

---

## Security Benefits

Using `zopp run` is more secure than `zopp secret export`:

| Approach | Secrets on disk | Secrets in shell history |
|----------|-----------------|--------------------------|
| `zopp run -- cmd` | No | No |
| `zopp secret export -o .env` | Yes | No |
| `export KEY=$(zopp secret get KEY)` | No | Yes |

Secrets are:
- Never written to disk
- Not visible in shell history
- Only available to the child process
- Cleaned up when the process exits

---

## Exit Codes

`zopp run` returns the exit code of the executed command:

```bash
zopp run -- exit 42
echo $?
# 42
```

This allows proper error handling in scripts:

```bash
zopp run -- npm test || echo "Tests failed!"
```

---

## Limitations

- All secrets in the environment are injected (no filtering)
- Secret names become environment variable names (must be valid identifiers)
- Large number of secrets may hit shell environment limits
- Secrets are visible to the child process and any processes it spawns

---

## Notes

- The `--` separator is required to distinguish zopp options from the command
- Environment variables from your shell are preserved and merged with secrets
- If a secret name conflicts with an existing environment variable, the secret wins
- Use `zopp secret export` if you need secrets in a file instead

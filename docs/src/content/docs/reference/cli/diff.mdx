---
title: diff
description: Compare secrets with external systems.
---

The `diff` command compares zopp secrets with external systems to identify changes.

## Commands

| Command | Description |
|---------|-------------|
| `k8s` | Diff with a Kubernetes Secret |

---

## diff k8s

Compare zopp secrets with a Kubernetes Secret.

### Usage

```bash
zopp diff k8s \
  [-w <WORKSPACE>] [-p <PROJECT>] [-e <ENVIRONMENT>] \
  --namespace <NAMESPACE> --secret <SECRET_NAME> \
  [--kubeconfig <PATH>] [--context <CONTEXT>]
```

### Options

| Option | Description |
|--------|-------------|
| `-w, --workspace <NAME>` | Workspace name (optional if in `zopp.toml`) |
| `-p, --project <NAME>` | Project name (optional if in `zopp.toml`) |
| `-e, --environment <NAME>` | Environment name (optional if in `zopp.toml`) |
| `--namespace <NS>` | Kubernetes namespace (required) |
| `--secret <NAME>` | Kubernetes Secret name (required) |
| `--kubeconfig <PATH>` | Path to kubeconfig (default: `~/.kube/config`) |
| `--context <CTX>` | Kubernetes context to use |

### Example

```bash
zopp diff k8s -e production --namespace prod --secret api-env

# Output:
# Diff: zopp (production) vs k8s (prod/api-env)
#
# + NEW_API_KEY              (in zopp, not in k8s)
# ~ DATABASE_URL             (value differs)
# - OLD_CONFIG               (in k8s, not in zopp)
# = API_KEY                  (identical)
# = REDIS_URL                (identical)
#
# Summary: 1 new, 1 changed, 1 removed, 2 unchanged
```

---

## Output Legend

| Symbol | Meaning |
|--------|---------|
| `+` | New key (exists in zopp, not in Kubernetes) |
| `~` | Changed (exists in both, values differ) |
| `-` | Removed (exists in Kubernetes, not in zopp) |
| `=` | Unchanged (identical in both) |

---

## Use Cases

### Pre-sync verification

Check what will change before syncing:

```bash
# Preview changes
zopp diff k8s -e production --namespace prod --secret api-env

# If satisfied, sync
zopp sync k8s -e production --namespace prod --secret api-env
```

### Audit drift

Detect if secrets have been modified outside of zopp:

```bash
zopp diff k8s -e production --namespace prod --secret api-env

# If there are unexpected '-' entries, someone modified the K8s Secret directly
```

### CI/CD validation

Check for drift in CI pipelines:

```bash
# Exit with error if there's drift
zopp diff k8s -e production --namespace prod --secret api-env || {
  echo "Secrets out of sync!"
  exit 1
}
```

---

## No Secret Exists

If the Kubernetes Secret doesn't exist:

```bash
zopp diff k8s -e production --namespace prod --secret new-secret

# Output:
# Kubernetes Secret 'new-secret' does not exist in namespace 'prod'
# All 12 zopp secrets would be new
```

---

## Notes

- Values are compared after decrypting from zopp and decoding from Kubernetes
- The diff does not modify anythingâ€”use `sync k8s` to apply changes
- Requires read access to the Kubernetes namespace
